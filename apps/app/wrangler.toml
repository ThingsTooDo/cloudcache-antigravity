name = "app-worker"
main = "./dist-worker/worker.js"
compatibility_date = "2024-04-01"
# [build]
# command = "pnpm run build"



# Production routes
routes = [
  { pattern = "app.cloudcache.ai/*", zone_name = "cloudcache.ai" }
]

# Remote bindings for local dev (no .dev.vars needed)
# Note: remote bindings are enabled by default in Wrangler v4
[dev]
port = 8789

# D1 Database Bindings
[[d1_databases]]
binding = "DB"
database_name = "app-db"
database_id = "e4078d2b-2e36-454e-a6e9-994b747e4fd8"

# KV Namespaces
[[kv_namespaces]]
binding = "APP_KV"
id = "5df224d061fb4f869a1a713f1ebd7252"

# Staging environment
[env.staging]
name = "app-worker-staging"
routes = [
  { pattern = "staging-app.cloudcache.ai/*", zone_name = "cloudcache.ai" }
]

[[env.staging.d1_databases]]
binding = "DB"
database_name = "app-db"
database_id = "e4078d2b-2e36-454e-a6e9-994b747e4fd8"

# Preview environment
[env.preview]
name = "app-worker-preview"
workers_dev = true
routes = []

[[env.preview.kv_namespaces]]
binding = "APP_KV"
id = "58050e98476b42578f917f32582b6647"

# Add D1 database binding for preview (same as production)
[[env.preview.d1_databases]]
binding = "APP_D1"
database_name = "app-db"
database_id = "e4078d2b-2e36-454e-a6e9-994b747e4fd8"

# D1 Database Binding


# Cron Triggers
[triggers]
crons = ["*/15 * * * *"] # Every 15 minutes

# D1 Database Binding
[[d1_databases]]
binding = "APP_D1"
database_name = "app-db"
database_id = "e4078d2b-2e36-454e-a6e9-994b747e4fd8"
