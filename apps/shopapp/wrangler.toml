name = "shopapp-worker"
main = "dist/index.js"
compatibility_date = "2025-10-07"



# Production routes
routes = [
  { pattern = "shopapp.cloudcache.ai/*", zone_name = "cloudcache.ai" }
]

# Remote bindings for local dev (no .dev.vars needed)
# Note: remote bindings are enabled by default in Wrangler v4
[dev]
port = 8789

# Production KV namespace
[[kv_namespaces]]
binding = "APP_KV"
id = "0b01afadb4984342a5e0ef09d7ff5fcd"

# Staging environment
[env.staging]
name = "shopapp-worker-staging"
routes = [
  { pattern = "staging-shopapp.cloudcache.ai/*", zone_name = "cloudcache.ai" }
]

[[env.staging.kv_namespaces]]
binding = "APP_KV"
id = "5df224d061fb4f869a1a713f1ebd7252"

# Preview environment
[env.preview]
name = "shopapp-worker-preview"
# Preview has no routes - uses workers.dev subdomain
routes = []
workers_dev = true

[[env.preview.kv_namespaces]]
binding = "APP_KV"
id = "58050e98476b42578f917f32582b6647"

[[env.preview.d1_databases]]
binding = "APP_D1"
database_name = "app-db"
database_id = "e4078d2b-2e36-454e-a6e9-994b747e4fd8"

# D1 Database Binding


# Cron Triggers
[triggers]
crons = ["*/15 * * * *"] # Every 15 minutes

# D1 Database Binding
[[d1_databases]]
binding = "APP_D1"
database_name = "app-db"
database_id = "e4078d2b-2e36-454e-a6e9-994b747e4fd8"
